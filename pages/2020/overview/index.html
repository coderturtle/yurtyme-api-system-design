<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.75.1" />
    <meta name="description" content="Yurtyme System Design 2020">
<meta name="author" content="Derm Duncan">

    <link rel="icon" href="/yurtyme-api-system-design/pages/images/favicon.png" type="image/png">

    <title>High Level Solution :: Yurtyme System Design 2020</title>

    
    <link href="/yurtyme-api-system-design/pages/css/nucleus.css?1602665057" rel="stylesheet">
    <link href="/yurtyme-api-system-design/pages/css/fontawesome-all.min.css?1602665057" rel="stylesheet">
    <link href="/yurtyme-api-system-design/pages/css/hybrid.css?1602665057" rel="stylesheet">
    <link href="/yurtyme-api-system-design/pages/css/featherlight.min.css?1602665057" rel="stylesheet">
    <link href="/yurtyme-api-system-design/pages/css/perfect-scrollbar.min.css?1602665057" rel="stylesheet">
    <link href="/yurtyme-api-system-design/pages/css/auto-complete.css?1602665057" rel="stylesheet">
    <link href="/yurtyme-api-system-design/pages/css/atom-one-dark-reasonable.css?1602665057" rel="stylesheet">
    <link href="/yurtyme-api-system-design/pages/css/theme.css?1602665057" rel="stylesheet">
    <link href="/yurtyme-api-system-design/pages/css/hugo-theme.css?1602665057" rel="stylesheet">
    
    <link href="/yurtyme-api-system-design/pages/css/theme-red.css?1602665057" rel="stylesheet">
    
    

    <script src="/yurtyme-api-system-design/pages/js/jquery-3.3.1.min.js?1602665057"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/yurtyme-api-system-design/pages/2020/overview/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">
  <img src="images/yurtyme.png" />
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/yurtyme-api-system-design/pages/js/lunr.min.js?1602665057"></script>
<script type="text/javascript" src="/yurtyme-api-system-design/pages/js/auto-complete.js?1602665057"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/coderturtle.github.io\/yurtyme-api-system-design\/pages";
    
</script>
<script type="text/javascript" src="/yurtyme-api-system-design/pages/js/search.js?1602665057"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/yurtyme-api-system-design/pages/overview/" title="Overview" class="dd-item 
        
        
        
        ">
      <a href="/yurtyme-api-system-design/pages/overview/">
          <b>1. </b>Overview
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/yurtyme-api-system-design/pages/overview/requirements/" title="Requirements" class="dd-item 
        
        
        
        ">
      <a href="/yurtyme-api-system-design/pages/overview/requirements/">
          <b>a. </b>Requirements
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/yurtyme-api-system-design/pages/2020/" title="2020 System Design Prototype" class="dd-item 
        parent
        
        
        ">
      <a href="/yurtyme-api-system-design/pages/2020/">
          <b>2. </b>2020 System Design Prototype
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/yurtyme-api-system-design/pages/2020/overview/" title="High Level Solution" class="dd-item 
        parent
        active
        
        ">
      <a href="/yurtyme-api-system-design/pages/2020/overview/">
          <b>a. </b>High Level Solution
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/yurtyme-api-system-design/pages/2020/aws-design/" title="Potential AWS Implementation" class="dd-item 
        
        
        
        ">
      <a href="/yurtyme-api-system-design/pages/2020/aws-design/">
          <b>b. </b>Potential AWS Implementation
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/yurtyme-api-system-design/pages/2020/pwa/" title="PWA Front-end" class="dd-item 
        
        
        
        ">
      <a href="/yurtyme-api-system-design/pages/2020/pwa/">
          <b>c. </b>PWA Front-end
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/yurtyme-api-system-design/pages/2020/back-end/" title="Back End Design" class="dd-item 
        
        
        
        ">
      <a href="/yurtyme-api-system-design/pages/2020/back-end/">
          <b>d. </b>Back End Design
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/yurtyme-api-system-design/pages/2020/analytics/" title="Data Analytics" class="dd-item 
        
        
        
        ">
      <a href="/yurtyme-api-system-design/pages/2020/analytics/">
          <b>e. </b>Data Analytics
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/coderturtle/yurtyme-api-system-design/"><i class='fab fa-fw fa-github'></i> GitHub repo</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://coderturtle.github.io/yurtyme-api-system-design"><i class='fas fa-fw fa-camera'></i> Showcases</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://gohugo.io/"><i class='fas fa-fw fa-bookmark'></i> Hugo Documentation</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <center>
    
    <a class="github-button" href="https://github.com/matcornic/hugo-theme-learn/archive/master.zip" data-icon="octicon-cloud-download" aria-label="Download matcornic/hugo-theme-learn on GitHub">Download</a>

    
    <a class="github-button" href="https://github.com/matcornic/hugo-theme-learn" data-icon="octicon-star" data-show-count="true" aria-label="Star matcornic/hugo-theme-learn on GitHub">Star</a>

    
    <a class="github-button" href="https://github.com/matcornic/hugo-theme-learn/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork matcornic/hugo-theme-learn on GitHub">Fork</a>

    <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>
</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/coderturtle/yurtyme-api-system-design/walkthrough-site2020/overview/_index.en.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/yurtyme-api-system-design/pages/'>Yurtyme</a> > <a href='/yurtyme-api-system-design/pages/2020/'>2020 System Design Prototype</a> > High Level Solution
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#setup">Setup</a></li>
        <li><a href="#additional-questions">Additional Questions</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              High Level Solution
            </h1>
          

        



	<h3 id="setup">Setup</h3>
<p>At a super high level there are 3 pieces to our system</p>
<ul>
<li>A PWA front-end</li>
<li>A simple backend with an API and some persistent storage</li>
<li>A Queing System</li>
</ul>
<p><img src="images/back_end_high_level.png" alt="Architecture"></p>
<p>The Distributed Database can store the User and Bars Profiles (Name, Email, etc). Distributed Databases scale well as we add more users.</p>
<p>The In-Memory Database is used for fast lookups and updates. We can store two things here.</p>
<ol>
<li>
<p>States of active Users and Bars.</p>
</li>
<li>
<p>User&rsquo;s Location (for sending ETA to bars)</p>
</li>
</ol>
<p>When a request comes in, it gets assigned to an App Server. We will make our REST API stateless so that any App Server can handle a request. This makes it easy to scale app servers by adding more machines.</p>
<h4 id="what-happens-when-a-user-requests-to-join-a-queue">What happens when a user requests to join a queue</h4>
<p>When a user requests to join a queue, the app server sets the User to the REQUESTING state. It then sends a request to the Queing system to make a request to the bar.</p>
<p>The Queing System maintains a pool of available bars (WAITING state). It first sends a queing request to the selected bar. If this is rejected or the queue time is over a specified period, the system keeps sending requests to nearby bars until one accepts or we run out of nearby bars.</p>
<p>If the selected bar accepts the app server matches the user to the bars queue and sets the users status to Queing. This blocks the user from queing at any other nearby bars. It also notifies the bar that the user is in the virtual queue.</p>
<p>If, for whatever reason, the selected bar can&rsquo;t accomodate the user but an alternative is found, the queing system responds to the app server with the bar info. This is sent to the user where they can either confirm they want to join that bars queue or reject it and search again.</p>
<p>At each state change, we inform the User/Bar of the change, so that the mobile UIs can be updated. With the notification, we also send any other info the device might need. For example, when the User is notified that he/she has been changed to the QUEING state, we also calculate the Queing Time and send that with the notification, so that the User&rsquo;s device can display the Queue Time and alert when it&rsquo;s time to physically go to the bar.</p>

<div class="notices note" ><p>We use a similar flow for all our API requests. A Request goes to an App Server, and the App Server processes the request. This involves State Updates to the In Memory DB, Profile Updates to the NoSQL DB, Requests to/from the Queing System and notifying the Users/Bars of State changes.</p>
</div>

<h4 id="how-is-the-do-users-know-which-bars-have-queue-availability-as-they-move-around">How is the do users know which bars have queue availability as they move around</h4>
<p>We need to periodically ping the User&rsquo;s location for all active bars (drivers not in the QUEUE_FULL state). This can be part of the mobile application. The app can periodically call an HTTP handler with the users&rsquo;s current location. This location is simply written to the In-Memory DB by App Servers. The location is also sent to the Queing System.</p>
<p>The Queing System needs to keep the User&rsquo;s location updated. The Queing System finds bars near a user. It will store each active users&rsquo;s location in a Spatial Index for such queries. Bars locations are stationary.</p>
<h3 id="additional-questions">Additional Questions</h3>
<h4 id="how-do-you-know-when-a-user-finishes-queing-and-enters-the-bar">How do you know when a user finishes queing and enters the bar</h4>
<p>The System can verify the users and bar location is the same for a period longer than the queing time.</p>





<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/yurtyme-api-system-design/pages/2020/" title="2020 System Design Prototype"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/yurtyme-api-system-design/pages/2020/aws-design/" title="Potential AWS Implementation" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/yurtyme-api-system-design/pages/js/clipboard.min.js?1602665057"></script>
    <script src="/yurtyme-api-system-design/pages/js/perfect-scrollbar.min.js?1602665057"></script>
    <script src="/yurtyme-api-system-design/pages/js/perfect-scrollbar.jquery.min.js?1602665057"></script>
    <script src="/yurtyme-api-system-design/pages/js/jquery.sticky.js?1602665057"></script>
    <script src="/yurtyme-api-system-design/pages/js/featherlight.min.js?1602665057"></script>
    <script src="/yurtyme-api-system-design/pages/js/highlight.pack.js?1602665057"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/yurtyme-api-system-design/pages/js/modernizr.custom-3.6.0.js?1602665057"></script>
    <script src="/yurtyme-api-system-design/pages/js/learn.js?1602665057"></script>
    <script src="/yurtyme-api-system-design/pages/js/hugo-learn.js?1602665057"></script>
    
        
            <script src="/yurtyme-api-system-design/pages/mermaid/mermaid.js?1602665057"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-105947713-1', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
